import{r as l,U as S,u as w,a as F,b as P,j as e,m as U,B as C,C as E,L,y as m}from"./index-D5wShA4Q.js";function D(){const[o,p]=l.useState(!1),{user:t}=l.useContext(S),[x,u]=l.useState(t.photo),[r,h]=l.useState(null),{mutate:f,isLoading:n}=w(t.uid),c=F(),{register:i,handleSubmit:j,formState:{errors:y}}=P({defaultValues:{pseudo:(t==null?void 0:t.pseudo)||"",firstName:(t==null?void 0:t.firstName)||"",name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",birthday:(t==null?void 0:t.birthday)||"",city:(t==null?void 0:t.city)||"",country:(t==null?void 0:t.country)||""}}),N=s=>{h(s.target.files[0])},g=async()=>{const s=new FormData;s.append("photo",r),s.append("oldPhotoPath",t.photo);const a=await fetch("http://localhost/React/project-w/backend/uploads.php",{method:"POST",body:s});if(!a.ok)throw new Error("Erreur lors du téléchargement de la photo");return(await a.json()).url},b=s=>{const a=s.target.files[0];a&&u(URL.createObjectURL(a))},v=async s=>{let a=t.photo;r&&(a=await g());const d={photo:a,...s};f(d,{onSuccess:()=>{m.success("Vos informations ont été modifiées avec succès"),p(!0)},onError:()=>{m.error("Une erreur est survenue lors de la modification de vos informations")}})};return l.useEffect(()=>{o&&c("/settings")},[o,c]),e.jsxs(U.main,{initial:{y:30,opacity:0},animate:{y:0,opacity:1},transition:{duration:.2},children:[e.jsx("div",{className:"mb-8 text-center md:text-start",children:"Saisissez vos informations personnelles:"}),e.jsxs("form",{className:"flex flex-col-reverse md:flex-row justify-between",onSubmit:j(v),children:[e.jsxs("div",{className:" ml-5 flex flex-col justify-between gap-5 items-center md:items-start",children:[e.jsxs("p",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-500 mr-3",htmlFor:"pseudo",children:"Pseudo:"}),e.jsx("input",{className:"inputSettings",id:"pseudo",...i("pseudo",{required:!0,validate:s=>s.trim().length>0||"Ce champ ne peut pas contenir de caractère vide"})}),y.pseudo&&e.jsx("p",{className:"text-red-600 my-1",children:"Ce champ ne peut pas être vide."})]}),e.jsxs("p",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-500 mr-3",htmlFor:"firstName",children:"Prénom:"}),e.jsx("input",{className:"inputSettings",id:"firstName",...i("firstName")})]}),e.jsxs("p",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-500 mr-3",htmlFor:"name",children:"Nom:"}),e.jsx("input",{className:"inputSettings",id:"name",...i("name")})]}),e.jsxs("p",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-500 mr-3",htmlFor:"name",children:"Email"}),e.jsx("input",{className:"inputSettings opacity-50 cursor-not-allowed",id:"email",...i("email"),disabled:!0})]}),e.jsxs("p",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-500 mr-3",htmlFor:"birthday",children:"Date de naissance:"}),e.jsx("input",{className:"inputSettings cursor-text",id:"birthday",type:"date",...i("birthday")})]}),e.jsxs("p",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-500 mr-3",htmlFor:"city",children:"Ville:"}),e.jsx("input",{className:"inputSettings",id:"city",...i("city")})]}),e.jsxs("p",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-500 mr-3",htmlFor:"country",children:"Pays:"}),e.jsx("input",{className:"inputSettings",id:"country",...i("country")})]}),e.jsxs("div",{className:"flex gap-6 items-center",children:[e.jsx(C,{type:"submit",disabled:n,children:n?e.jsxs("div",{children:["Envoie...",e.jsx(E,{size:10,color:"white"})]}):"Valider"}),e.jsx(L,{className:"bg-gray-500/30 rounded-3xl px-4 py-2 font-semibold text-sm  hover:bg-blue-500/30 cursor-pointer transition-color duration-300",to:"/settings",children:"Retour"})]})]}),e.jsxs("div",{className:"flex flex-col gap-5 items-center",children:[e.jsx("img",{className:"w-[150px] h-[150px] rounded",src:x}),e.jsx("label",{htmlFor:"file-upload",className:"hover:cursor-pointer hover:text-blue-600 hover:underline border border-gray-600 rounded mt-5 mb-10 p-2",children:"Modifier la photo de profil"}),e.jsx("input",{id:"file-upload",name:"photo",onChange:s=>{N(s),b(s)},type:"file",className:"hidden"})]})]})]})}export{D as default};
